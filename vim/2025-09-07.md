## Vim置換

Vimの置換コマンドは、通常`:`（ノーマルモードでコロン）から始めます。基本的な置換の書式は以下の通りです。

```vim
:[range]s/pattern/replacement/[flags]
```

各要素について詳しく見ていきましょう。

### 1\. `:[range]` (対象範囲)

置換を適用する範囲を指定します。省略した場合は、現在カーソルがある行のみが対象となります。

  * **`:`**：現在の行
  * **`:%`**：ファイル全体
  * **`:`**`[開始行],[終了行]`：指定した行範囲
      * 例: `5,10s/foo/bar/g` （5行目から10行目までの`foo`を`bar`に置換）
      * 例: `.,$s/foo/bar/g` （現在行から最終行までの`foo`を`bar`に置換）

### 2\. `s/pattern/replacement/` (置換の内容)

これが置換のメイン部分です。

  * **`s`**：置換を意味するコマンドです。
  * **`pattern`**：検索する文字列（正規表現が使えます）
  * **`replacement`**：置き換える文字列

区切り文字は、`s/`のようにスラッシュ`/`を使うのが一般的ですが、`s#`のようにシャープ`#`や`s|`のようにパイプ`|`など、他の文字も使えます。これは、`pattern`や`replacement`に`/`が含まれる場合に便利です。

  * 例: `/home/user/` を `/var/www/` に置換したい場合
      * `:%s#/home/user/#/var/www/#g`

### 3\. `[flags]` (オプション)

置換の動作を制御するオプションです。

  * **`g`**：`g`は「global」の略で、1行の中に`pattern`が複数ある場合に、すべてを置換します。これを付けないと、最初に見つかったものだけが置換されます。
  * **`i`**：`i`は「ignore case」の略で、大文字・小文字を区別せずに検索します。
  * **`c`**：`c`は「confirm」の略で、置換を行う前に一つずつ確認を求めます。`y`で置換、`n`でスキップ、`a`で全て置換、`q`で中断など。
  * **`n`**：`n`は「number」の略で、置換は行わずに、マッチした個数を表示します。

-----

### よく使う置換コマンドの例

#### 1\. カーソルがある行の最初の`foo`を`bar`に置換

```vim
:s/foo/bar/
```

#### 2\. カーソルがある行のすべての`foo`を`bar`に置換

```vim
:s/foo/bar/g
```

#### 3\. ファイル全体のすべての`foo`を`bar`に置換

```vim
:%s/foo/bar/g
```

#### 4\. ファイル全体の大文字小文字を区別せず、`Apple`や`apple`をすべて`Orange`に置換

```vim
:%s/apple/Orange/gi
```

#### 5\. ファイル全体の置換を一つずつ確認しながら行う

```vim
:%s/foo/bar/gc
```

#### 6\. 特定の行範囲（例: 10行目から20行目）の置換

```vim
:10,20s/pattern/replacement/g
```

#### 7\. 検索した文字列を、そのまま置換後の文字列として使いたい場合

`&`や`\0`を使うと、検索にマッチした文字列を`replacement`部分で再利用できます。

  * 例: `word`を`"word"`に置換
      * `:%s/word/"&"/g`
      * `:%s/word/"\0"/g`

### 正規表現の注意点

Vimの正規表現は、デフォルトで一部の特殊文字（`+`, `?`, `|`, `(`, `)`など）をエスケープする必要があります。

  * 例: `(foo|bar)` を検索したい場合
      * `:%s/\(foo\|bar\)/.../g`

`\v`（very magic）を使用すると、これらの文字をエスケープせずに済み、より直感的に正規表現を使えます。

  * 例: `(foo|bar)` を検索したい場合
      * `:%s/\v(foo|bar)/.../g`

これらのコマンドを使いこなすことで、Vimでの編集作業が格段に効率化されます。ぜひ試してみてください。
